<template>
    <div class="py-[130px] bg-[#f3f3f3]">
        <ul class="cards relative w-[300px] h-[455px] left-[50%] md:w-[400px]">
    
            <!-- Raccolta autorizzata -->
            <li class="rounded-[12px] shadow-lg m-5 bg-white">
                <img class="w-full" src="../../assets/img/servizio1.jpg" alt="Servizio 1" />
                <div class="px-6 py-4">
                    <div class="font-bold text-black text-p2 mb-2 md:text-[24px]">
                    Raccolta autorizzata
                    </div>
                    <p class="text-grey-3 font-paragraph text-p3 md:text-p2">
                    Qorem ipsum dolor sit amet, consectetur adipiscing elit.
                    </p>
                    <img class="mt-4" src="../../assets/img/line.svg" alt="Line" />
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/chart-bar.svg" alt="chart bar" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Il pi√π efficace</p>
                    </div>
                    </div>
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/awards.svg" alt="Awards" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Da anni top leader</p>
                    </div>
                    </div>
        
                    <div class="mt-8 flex items-center">
                    <div>
                        <p class="text-green-mid-4 text-p3 font-title md:text-p2">Scopri il servizio</p>
                    </div>
        
                    <div class="ml-2">
                        <img
                        src="../../assets/img/arrow-right-green.svg"
                        alt="Arrow right green"
                        />
                    </div>
                    </div>
                </div>
            </li>
    
            <!-- Bonifica ambienti -->
            <li class="rounded-[12px] shadow-lg m-5 bg-white">
                <img class="w-full" src="../../assets/img/bonifica-ambienti.jpg" alt="Bonifica ambienti" />
                <div class="px-6 py-4">
                    <div class="font-bold text-black text-p2 mb-2 md:text-[24px]">
                        Bonifica ambienti
                    </div>
                    <p class="text-grey-3 font-paragraph text-p3 md:text-p2">
                    Qorem ipsum dolor sit amet, consectetur adipiscing elit.
                    </p>
                    <img class="mt-4" src="../../assets/img/line.svg" alt="Line" />
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/sparkles.svg" alt="chart bar" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Pulizia a fondo</p>
                    </div>
                    </div>
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/soap.svg" alt="Awards" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Massima igiene</p>
                    </div>
                    </div>
        
                    <div class="mt-8 flex items-center">
                    <div>
                        <p class="text-green-mid-4 text-p3 font-title md:text-p2">Scopri il servizio</p>
                    </div>
        
                    <div class="ml-2">
                        <img
                        src="../../assets/img/arrow-right-green.svg"
                        alt="Arrow right green"
                        />
                    </div>
                    </div>
                </div>
            </li>
    
            <!-- Linea meccanica ad aghi -->
            <li class="rounded-[12px] shadow-lg m-5 bg-white">
                <img class="w-full" src="../../assets/img/linea-meccanica.jpg" alt="Linea meccanica ad aghi" />
                <div class="px-6 py-4">
                    <div class="font-bold text-black text-p2 mb-2 md:text-[24px]">
                        Linea meccanica ad aghi
                    </div>
                    <p class="text-grey-3 font-paragraph text-p3 md:text-p2">
                    Qorem ipsum dolor sit amet, consectetur adipiscing elit.
                    </p>
                    <img class="mt-4" src="../../assets/img/line.svg" alt="Line" />
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/time.svg" alt="Time" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Effetto a lunga durata</p>
                    </div>
                    </div>
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/database.svg" alt="Database" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Economico</p>
                    </div>
                    </div>
        
                    <div class="mt-8 flex items-center">
                    <div>
                        <p class="text-green-mid-4 text-p3 font-title md:text-p2">Scopri il servizio</p>
                    </div>
        
                    <div class="ml-2">
                        <img
                        src="../../assets/img/arrow-right-green.svg"
                        alt="Arrow right green"
                        />
                    </div>
                    </div>
                </div>
            </li>
            
            <!-- Nebulizzatore zanzare -->
            <li class="rounded-[12px] shadow-lg m-5 bg-white">
                <img class="w-full" src="../../assets/img/nebulizzatore-zanzare.jpg" alt="Nebulizzatore zanzare" />
                <div class="px-6 py-4">
                    <div class="font-bold text-black text-p2 mb-2 md:text-[24px]">
                        Nebulizzatore zanzare
                    </div>
                    <p class="text-grey-3 font-paragraph text-p3 md:text-p2">
                    Qorem ipsum dolor sit amet, consectetur adipiscing elit.
                    </p>
                    <img class="mt-4" src="../../assets/img/line.svg" alt="Line" />
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/plus.svg" alt="Plus" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Disinfestazione garantita</p>
                    </div>
                    </div>
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/circle.svg" alt="Circle" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Definitiva</p>
                    </div>
                    </div>
        
                    <div class="mt-8 flex items-center">
                    <div>
                        <p class="text-green-mid-4 text-p3 font-title md:text-p2">Scopri il servizio</p>
                    </div>
        
                    <div class="ml-2">
                        <img
                        src="../../assets/img/arrow-right-green.svg"
                        alt="Arrow right green"
                        />
                    </div>
                    </div>
                </div>
            </li>
            
            <!-- Falco elettronico -->
            <li class="rounded-[12px] shadow-lg m-5 bg-white">
                <img class="w-full" src="../../assets/img/falco-elettronico.jpg" alt="Falco elettronico" />
                <div class="px-6 py-4">
                    <div class="font-bold text-black text-p2 mb-2 md:text-[24px]">
                        Falco elettronico
                    </div>
                    <p class="text-grey-3 font-paragraph text-p3 md:text-p2">
                    Qorem ipsum dolor sit amet, consectetur adipiscing elit.
                    </p>
                    <img class="mt-4" src="../../assets/img/line.svg" alt="Line" />
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/plus.svg" alt="Plus" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Disinfestazione garantita</p>
                    </div>
                    </div>
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/circle.svg" alt="Circle" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Definitiva</p>
                    </div>
                    </div>
        
                    <div class="mt-8 flex items-center">
                    <div>
                        <p class="text-green-mid-4 text-p3 font-title md:text-p2">Scopri il servizio</p>
                    </div>
        
                    <div class="ml-2">
                        <img
                        src="../../assets/img/arrow-right-green.svg"
                        alt="Arrow right green"
                        />
                    </div>
                    </div>
                </div>
            </li>
            
            <!-- Reti anti-intrusione -->
            <li class="rounded-[12px] shadow-lg m-5 bg-white">
                <img class="w-full" src="../../assets/img/reti-anti-intrusione.jpg" alt="Reti anti intrusione" />
                <div class="px-6 py-4">
                    <div class="font-bold text-black text-p2 mb-2 md:text-[24px]">
                        Reti anti intrusione
                    </div>
                    <p class="text-grey-3 font-paragraph text-p3 md:text-p2">
                    Qorem ipsum dolor sit amet, consectetur adipiscing elit.
                    </p>
                    <img class="mt-4" src="../../assets/img/line.svg" alt="Line" />
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/plus.svg" alt="Plus" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Disinfestazione garantita</p>
                    </div>
                    </div>
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/circle.svg" alt="Circle" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Definitiva</p>
                    </div>
                    </div>
        
                    <div class="mt-8 flex items-center">
                    <div>
                        <p class="text-green-mid-4 text-p3 font-title md:text-p2">Scopri il servizio</p>
                    </div>
        
                    <div class="ml-2">
                        <img
                        src="../../assets/img/arrow-right-green.svg"
                        alt="Arrow right green"
                        />
                    </div>
                    </div>
                </div>
            </li>
    
            <!-- Linea elettrificata -->
            <li class="rounded-[12px] shadow-lg m-5 bg-white">
                <img class="w-full" src="../../assets/img/linea-elettrificata.jpg" alt="Linea elettrificata" />
                <div class="px-6 py-4">
                    <div class="font-bold text-black text-p2 mb-2 md:text-[24px]">
                        Linea elettrificata
                    </div>
                    <p class="text-grey-3 font-paragraph text-p3 md:text-p2">
                    Qorem ipsum dolor sit amet, consectetur adipiscing elit.
                    </p>
                    <img class="mt-4" src="../../assets/img/line.svg" alt="Line" />
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/plus.svg" alt="Plus" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Disinfestazione garantita</p>
                    </div>
                    </div>
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/circle.svg" alt="Circle" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Definitiva</p>
                    </div>
                    </div>
        
                    <div class="mt-8 flex items-center">
                    <div>
                        <p class="text-green-mid-4 text-p3 font-title md:text-p2">Scopri il servizio</p>
                    </div>
        
                    <div class="ml-2">
                        <img
                        src="../../assets/img/arrow-right-green.svg"
                        alt="Arrow right green"
                        />
                    </div>
                    </div>
                </div>
            </li>
    
            <!-- Filo ballerino -->
            <li class="rounded-[12px] shadow-lg m-5 bg-white">
                <img class="w-full" src="../../assets/img/filo-ballerino.jpg" alt="Filo ballerino" />
                <div class="px-6 py-4">
                    <div class="font-bold text-black text-p2 mb-2 md:text-[24px]">
                        Filo ballerino
                    </div>
                    <p class="text-grey-3 font-paragraph text-p3 md:text-p2">
                    Qorem ipsum dolor sit amet, consectetur adipiscing elit.
                    </p>
                    <img class="mt-4" src="../../assets/img/line.svg" alt="Line" />
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/plus.svg" alt="Plus" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Disinfestazione garantita</p>
                    </div>
                    </div>
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/circle.svg" alt="Circle" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Definitiva</p>
                    </div>
                    </div>
        
                    <div class="mt-8 flex items-center">
                    <div>
                        <p class="text-green-mid-4 text-p3 font-title md:text-p2">Scopri il servizio</p>
                    </div>
        
                    <div class="ml-2">
                        <img
                        src="../../assets/img/arrow-right-green.svg"
                        alt="Arrow right green"
                        />
                    </div>
                    </div>
                </div>
            </li>
            
            <!-- Falconiere autorizzato -->
            <li class="rounded-[12px] shadow-lg m-5 bg-white">
                <img class="w-full" src="../../assets/img/falconiere-autorizzato.jpg" alt="Falconiere autorizzato" />
                <div class="px-6 py-4">
                    <div class="font-bold text-black text-p2 mb-2 md:text-[24px]">
                        Falconiere autorizzato
                    </div>
                    <p class="text-grey-3 font-paragraph text-p3 md:text-p2">
                    Qorem ipsum dolor sit amet, consectetur adipiscing elit.
                    </p>
                    <img class="mt-4" src="../../assets/img/line.svg" alt="Line" />
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/plus.svg" alt="Plus" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Disinfestazione garantita</p>
                    </div>
                    </div>
        
                    <div class="flex flex-row gap-2 mt-4">
                    <div>
                        <img src="../../assets/img/circle.svg" alt="Circle" />
                    </div>
                    <div>
                        <p class="text-grey-3 text-p3 font-title md:text-p2">Definitiva</p>
                    </div>
                    </div>
        
                    <div class="mt-8 flex items-center">
                    <div>
                        <p class="text-green-mid-4 text-p3 font-title md:text-p2">Scopri il servizio</p>
                    </div>
        
                    <div class="ml-2">
                        <img
                        src="../../assets/img/arrow-right-green.svg"
                        alt="Arrow right green"
                        />
                    </div>
                    </div>
                </div>
            </li>
        </ul>
  
        <div class="flex justify-center gap-[14px]">
            <button class="prev flex py-3 px-8 justify-center items-center rounded-xl bg-green-mid-2 hover:bg-green-dark-2" @click="prevCard" ref="prevButton">
                <img src="../../assets/img/arrow-left-white.svg" alt="Arrow left white">
            </button>
            <button class="next flex py-3 px-8 justify-center items-center rounded-xl bg-green-mid-2 hover:bg-green-dark-2" @click="nextCard" ref="nextButton">
                <img src="../../assets/img/arrow-right-white.svg" alt="Arrow right white">
            </button>
        </div>
    </div>
  
    <div class="drag-proxy absolute invisible"></div>
</template>
    
<script setup>
import { gsap } from 'gsap';
import { ref, onMounted } from 'vue';

let scrub;
let seamlessLoop;
let playhead;
let wrapTime;

const prevButton = ref();
const nextButton = ref();

onMounted(() =>{

    const spacing = 0.1;
    const cards = gsap.utils.toArray('.cards li');
    let iteration = 0;
    gsap.set('.cards li', { xPercent: 400, opacity: 0, scale: 0 });

    const snapTime = gsap.utils.snap(spacing);
    const animateFunc = (element) => {
        const tl = gsap.timeline();
        tl.fromTo(
            element,
            { scale: 0, opacity: 0 },
            {
            scale: 1,
            opacity: 1,
            zIndex: 100,
            duration: 0.5,
            yoyo: true,
            repeat: 1,
            ease: 'power1.in',
            immediateRender: false,
            }
        ).fromTo(
            element,
            { xPercent: 400 },
            { xPercent: -400, duration: 1, ease: 'none', immediateRender: false },
            0
        );
        return tl;
    };
    seamlessLoop = buildSeamlessLoop(cards, spacing, animateFunc, 3),
    playhead = { offset: 0 },
    wrapTime = gsap.utils.wrap(0, seamlessLoop.duration()),
    scrub = gsap.to(playhead, {
        offset: 0,
        onUpdate() {
            seamlessLoop.time(wrapTime(playhead.offset));
        },
        duration: 0.5,
        ease: 'power3',
        paused: true,
    });

    function buildSeamlessLoop(items, spacing, animateFunc) {
        let rawSequence = gsap.timeline({ paused: true }),
        seamlessLoop = gsap.timeline({
            paused: true,
            repeat: -1,
            onRepeat() {
            this._time === this._dur && (this._tTime += this._dur - 0.01);
            },
            onReverseComplete() {
            this.totalTime(this.rawTime() + this.duration() * 100);
            },
        }),
        cycleDuration = spacing * items.length,
        dur;

        items
        .concat(items)
        .concat(items)
        .forEach((item, i) => {
            let anim = animateFunc(items[i % items.length]);
            rawSequence.add(anim, i * spacing);
            dur || (dur = anim.duration());
        });

        seamlessLoop.fromTo(
        rawSequence,
        {
            time: cycleDuration + dur / 2,
        },
        {
            time: '+=' + cycleDuration,
            duration: cycleDuration,
            ease: 'none',
        }
        );
        return seamlessLoop;
    }

    const prevCard = () => {
        scrollToOffset(scrub.vars.offset - spacing);
    };

    const nextCard = () => {
        scrollToOffset(scrub.vars.offset + spacing);
    };

    // Collega le funzioni ai pulsanti
    prevButton.value.addEventListener('click', prevCard);
    nextButton.value.addEventListener('click', nextCard);

    const scrollToOffset = (offset) => {
        scrub.vars.offset = offset;
        scrub.invalidate().restart();
    };

    // Imposta scrub in modo che sia accessibile al di fuori di questa funzione onMounted
    scrub = gsap.to(playhead, {
        offset: 0,
        onUpdate() {
            seamlessLoop.time(wrapTime(playhead.offset));
        },
        duration: 0.5,
        ease: 'power3',
        paused: true,
    });
});
</script>
    
<style>

.cards {
    transform: translate(-50%, -50%);
}

.cards li {
    width: 300px;
    height: 455px;
    position: absolute;
    box-shadow: 0px 30px 40px 0px rgba(0, 0, 0, 0.05);
    overflow: hidden;
}

.prev, .next {
  transition: transform 0.3s ease-in-out; /* Aggiungi una transizione */
}

@media screen and (min-width: 768px) {
    .cards li {
        width: 400px;
        height: 555px;
    }
}
</style>